# 日历应用产品报告

## 一、产品功能介绍

### 1. 基础功能

#### （1）多视图日历展示

- 月视图：以完整的月份网格布局展示，支持事件预览，事件以彩色圆点显示，事件过多时可点击“更多”展开查看完整列表。
- 周视图：采用时间轴式的事件排布，能清晰展示一周内各时间段的事件。
- 日视图：呈现详细的时间槽和事件显示，可精确查看一天中每个时间段的事件安排。
  
  #### （2）完整的事件管理
- 事件添加：支持自定义标题、描述、时间、颜色分类及提醒设置，可通过点击右下角“+”按钮、时间槽或日期事件模态框添加事件。
- 事件编辑：在事件详情中点击“编辑”按钮，可在预填充的表单中修改信息并保存。
- 事件查看：在月视图点击事件彩色圆点，周/日视图点击事件块，即可查看事件详细信息，包括农历信息等。
- 事件删除：在事件详情中进行删除操作，有安全的删除确认机制。
  
  ### 2. 扩展功能
  
  #### （1）日程提醒功能
- 支持基于浏览器通知 API 的提醒，可设置提前15分钟、30分钟、1小时等多时段提醒。
- 同时具备降级提醒方案，当浏览器通知无法使用时，会通过confirm弹窗进行提醒。
  
  #### （2）数据导入导出
- 支持 JSON 格式的日程数据导入导出，便于数据备份与迁移。
- 导出时会生成以“calendar - backup - 日期”命名的json文件；导入时可读取json文件并解析数据。
  
  #### （3）农历显示
- 在月/日视图中展示农历日期、节气及节日信息。
- 可通过开关控制农历的显示与隐藏，农历信息包括农历日期名称、节气、节日等。
  
  ## 二、程序概要设计
  
  ### 1. 技术栈
- 前端框架：Vue 3（采用 Composition API 进行组件开发）、Pinia（状态管理）
- 开发工具：Vite（快速构建工具）、date - fns（日期处理库）
- 跨端工具：Capacitor（实现Web应用转原生应用，支持部署至Android、iOS等平台）
- 其他：chinese - lunar（农历相关处理，虽项目中也有自开发的lunar.js工具类）、vant（UI组件库）等
  
  ### 2. 模块划分
- **components 组件层**：包含CalendarView（下有MonthView.vue、WeekView.vue、DayView.vue分别对应月、周、日视图）、EventForm.vue（事件表单，用于添加/编辑事件）、EventDetail.vue（事件详情查看）、DayEventsModal.vue（日期事件列表模态框）等组件，实现了不同视图和功能模块的展示与交互。
- **stores 状态管理层**：通过calendar.js实现日历状态的集中管理，包括当前显示日期、事件列表、视图模式、选中的事件等核心数据的存储与更新。
- **views 视图层**：主要有HomeView.vue作为主页面，整合各组件实现完整的日历应用页面展示。
- **utils 工具层**：包含lunar.js（农历工具类，提供公历与农历之间的转换功能）、reminder.js（提醒功能相关工具）等，为应用提供各种工具函数支持。
  
  ### 3. 数据存储与交互
- 事件数据采用Pinia进行状态管理，在前端进行存储，数据结构包括id、title、description、startTime、endTime、color、reminder等字段。
- 数据导入导出通过读取和生成JSON文件实现，利用FileReader读取导入文件内容，通过Blob和URL.createObjectURL生成导出文件。
  
  ### 4. 跨端部署
- 借助Capacitor实现Web应用到Android、iOS等原生应用的转换，通过配置capacitor.config.json，指定appId、appName、webDir等信息，将Web资源同步到对应平台项目中进行构建和运行。
  
  ## 三、软件架构图
  
  ```
  ┌─────────────────────────────────────────────────────────────────┐
  │ 客户端（浏览器/原生应用） │
  └───────────────────────────────┬─────────────────────────────────┘
  │
  ┌───────────────────────────────▼─────────────────────────────────┐
  │ 应用层（Vue 3 应用） │
  │ ┌───────────────┐ ┌───────────────┐ ┌───────────────────────┐ │
  │ │ 视图组件 │ │ 状态管理 │ │ 工具函数 │ │
  │ │ （views/...） │ │ （Pinia Store） │ │ （utils/...） │ │
  │ └───────────────┘ └───────────────┘ └───────────────────────┘ │
  │ ┌─────────────────────────────────────────────────────────────┐ │
  │ │ 组件层（components/...） │ │
  │ └─────────────────────────────────────────────────────────────┘ │
  └───────────────────────────────┬─────────────────────────────────┘
  │
  ┌───────────────────────────────▼─────────────────────────────────┐
  │ 构建工具（Vite） │
  └───────────────────────────────┬─────────────────────────────────┘
  │
  ┌───────────────────────────────▼─────────────────────────────────┐
  │ 跨端转换（Capacitor） │
  │ ┌───────────────┐ ┌───────────────┐ ┌───────────────────────┐ │
  │ │ Android 平台 │ │ iOS 平台 │ │ 其他平台 │ │
  │ └───────────────┘ └───────────────┘ └───────────────────────┘ │
  └─────────────────────────────────────────────────────────────────┘
  ```
  
  ## 四、技术亮点及其实现原理
  
  ### 1. 组件化架构
- **亮点**：采用高度可复用的日历视图组件，遵循单一职责原则的组件设计，具有清晰的组件通信机制。
- **实现原理**：将日历应用拆分为多个独立的组件，如MonthView、WeekView、DayView等视图组件，EventForm、EventDetail等功能组件。各组件只负责自身相关的功能，通过props和emit进行数据传递和事件通信，实现组件间的解耦，提高代码的可维护性和复用性。
  
  ### 2. 农历计算功能
- **亮点**：实现了公历与农历的转换，能显示农历日期、节气、节日等信息。
- **实现原理**：通过lunar.js工具类，内部包含农历数据表（1900 - 2100年）、节气数据等，采用精确的计算方法，根据公历日期计算对应的农历信息。先计算偏移天数，再根据偏移天数确定农历年份、月份、日期等，同时结合节气数据判断当前日期是否为节气。
  
  ### 3. 数据导入导出功能
- **亮点**：支持JSON格式的日程数据导入导出，方便用户进行数据备份和迁移。
- **实现原理**：导出时，从Pinia存储中获取事件数据，将其转换为JSON字符串，通过Blob对象创建文件，再利用a标签的download属性实现文件下载。导入时，通过FileReader读取上传的JSON文件内容，解析为事件数据后更新到Pinia存储中。
  
  ### 4. 响应式设计
- **亮点**：适配桌面（>1024px）、平板（768px - 1024px）、手机（<768px）等不同设备，提供良好的跨设备体验。
- **实现原理**：采用移动端优先的CSS设计，利用CSS Grid和Flexbox布局，结合媒体查询（@media）根据不同的屏幕宽度设置不同的样式规则，调整组件的布局、尺寸、排列方式等，以适应不同设备的显示需求。
  
  ### 5. 跨端开发与部署
- **亮点**：基于Capacitor实现Web应用到Android、iOS等原生应用的转换，实现一套代码多端运行。
- **实现原理**：Capacitor作为跨平台应用运行时，将Web应用包裹在原生应用壳中，通过配置文件指定Web资源目录等信息。在构建时，将Web应用打包生成的静态资源同步到各原生平台项目中，原生应用通过WebView加载这些Web资源，同时提供原生API的访问能力，使Web应用能够调用原生功能。
